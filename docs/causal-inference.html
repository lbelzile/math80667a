<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.3">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>13&nbsp; Causal inference – Experimental design and statistical methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./nonparametric.html" rel="next">
<link href="./mixed.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-81b5c3e63835cfde897ecd3d35a35a41.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-6f9cce838f3eabccbf7e52d05b4212be.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./causal-inference.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Causal inference</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Experimental design and statistical methods</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/lbelzile/math80667a/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./MATH80667A-EDSM.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hypothesis_testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Hypothesis testing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./completely_randomized_trials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Completely randomized designs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./contrasts_multipletesting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Contrasts and multiple testing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./twoway.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Complete factorial designs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./repeated.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Repeated measures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multiway.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Multiway factorial designs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./manova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Multivariate analysis of variance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ancova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Linear regression models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./power_effect.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Effect sizes and power</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reproducibility_crisis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Replication crisis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mixed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to mixed models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./causal-inference.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Causal inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonparametric.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Nonparametric tests</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./count.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Count data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#basics-of-causal-inference" id="toc-basics-of-causal-inference" class="nav-link active" data-scroll-target="#basics-of-causal-inference"><span class="header-section-number">13.1</span> Basics of causal inference</a>
  <ul class="collapse">
  <li><a href="#directed-acyclic-graph" id="toc-directed-acyclic-graph" class="nav-link" data-scroll-target="#directed-acyclic-graph"><span class="header-section-number">13.1.1</span> Directed acyclic graph</a></li>
  </ul></li>
  <li><a href="#mediation" id="toc-mediation" class="nav-link" data-scroll-target="#mediation"><span class="header-section-number">13.2</span> Mediation</a></li>
  <li><a href="#linear-mediation-model" id="toc-linear-mediation-model" class="nav-link" data-scroll-target="#linear-mediation-model"><span class="header-section-number">13.3</span> Linear mediation model</a>
  <ul class="collapse">
  <li><a href="#nonparametric-bootstrap" id="toc-nonparametric-bootstrap" class="nav-link" data-scroll-target="#nonparametric-bootstrap"><span class="header-section-number">13.3.1</span> Nonparametric bootstrap</a></li>
  </ul></li>
  <li><a href="#model-assumptions" id="toc-model-assumptions" class="nav-link" data-scroll-target="#model-assumptions"><span class="header-section-number">13.4</span> Model assumptions</a>
  <ul class="collapse">
  <li><a href="#sensitivity-analysis" id="toc-sensitivity-analysis" class="nav-link" data-scroll-target="#sensitivity-analysis"><span class="header-section-number">13.4.1</span> Sensitivity analysis</a></li>
  </ul></li>
  <li><a href="#general-average-causal-mediation-effect-estimation" id="toc-general-average-causal-mediation-effect-estimation" class="nav-link" data-scroll-target="#general-average-causal-mediation-effect-estimation"><span class="header-section-number">13.5</span> General average causal mediation effect estimation</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/lbelzile/math80667a/edit/main/causal-inference.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"><h1 class="title display-7"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Causal inference</span></h1></header>

<header id="title-block-header">


</header>


<p>Statisticians are famous for repeating <em>ad nauseam</em> that “correlation is not causation”. This statement illustrated on the website <a href="https://tylervigen.com/spurious-correlations">Spurious correlations</a> by Tyler Vigen, which shows multiple graphs of absurd relations, many of which are simply artifact of population growth. As second example, consider weather forecasts (of rain) and the number of people carrying umbrellas in the streets. These phenomena are positively correlated, but if I intervene and force everyone around to carry umbrellas, it will impact neither weather forecasts nor the weather itself. While correlation (effectively what is being measured in a linear regression model) contains information about presence of a relationship between two variables, it does not allow one to determine cause from effect (i.e., the direction). This can be determined through experiments, or via logical models.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-xkcd2569" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-xkcd2569-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/xkcd552_correlation.png" class="img-fluid figure-img" style="width:65.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-xkcd2569-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.1: xkcd comic <a href="https://xkcd.com/552/">552 (Correlation) by Randall Munroe</a>. Alt text: Correlation doesn’t imply causation, but it does waggle its eyebrows suggestively and gesture furtively while mouthing ‘look over there’. Cartoon reprinted under the <a href="https://creativecommons.org/licenses/by-nc/2.5/">CC BY-NC 2.5 license</a>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The field of <strong>causal inference</strong> is concerned with inferring the effect of an action or manipulation (intervention, policy, or treatment) applied to a measurement unit and identifying and quantifying the effect of one variable on other variables. Such action may be conceptual: we can imagine for example looking at student’s success (as measured by their grades) by comparing two policies: giving them timely feedback and encouragement, versus no feedback. In reality, only one of these two scenarios can be realized even if both can conceptually be envisioned as <strong>potential outcomes</strong>.</p>
<p>The content of this chapter is divided as follows. First, we discuss the logical interrelation between variables using directed acyclic graphs and focus on relations between triples defining confounders, colliders and mediators. We then describe how we can retrieve causal effects (in an abstract setting). Finally, we present the linear mediation model popularized by <span class="citation" data-cites="Judd.Kenny:1981">Judd and Kenny (<a href="references.html#ref-Judd.Kenny:1981" role="doc-biblioref">1981</a>)</span> and <span class="citation" data-cites="Baron.Kenny:1986">Baron and Kenny (<a href="references.html#ref-Baron.Kenny:1986" role="doc-biblioref">1986</a>)</span>. We focus on the hidden assumptions that can undermine causal claims in linear mediation models.</p>
<section id="basics-of-causal-inference" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="basics-of-causal-inference"><span class="header-section-number">13.1</span> Basics of causal inference</h2>
<p>In the first chapter, we stated that randomized experiments were the gold standard of science. This is mostly because, through careful control of conditions (keeping everything else constant) and manipulating experimental factors, we can determine whether the latter cause changes in the response. However, not everything can be studied using experiments and we need more general rules and definitions to study causal inference when randomization isn’t possible.</p>
<p>Denote by <span class="math inline">\(Y_i(j)\)</span> the potential outcome of individual <span class="math inline">\(i\)</span> assigned to treatment <span class="math inline">\(X_j\)</span>, i.e., the value of the response in an hypothetical world where we assigned this observation to a particular group. With a binary treatment <span class="math inline">\(X \in \{0,1\}\)</span>, we would be interested by the difference in individual response, <span class="math inline">\(Y(1)-Y(0)\)</span> or the individual response <span class="math inline">\(Y(1)/Y(0)\)</span>, depending on the context, and this readily extends to more than two groups. In an experiment, we can manipulate assignment to treatment <span class="math inline">\(X\)</span> and randomize units to each value of the treatment to avoid undue effects from other variables. The potential outcomes framework applies to in between-subject designs because experimental units are assigned to a single treatment, whereas in within-subject designs a single ordering is presented. The fundamental problem of causal inference is that, while we would like to study the impact of every action on our response for each individual, only one of these potential outcomes is observed: at least half of the potential outcomes are unobserved.</p>
<div class="cell">
<div id="tbl-missing" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-missing-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;13.1: Potential outcomes <span class="math inline">\(Y(0)\)</span>, <span class="math inline">\(Y(1)\)</span> with a binary treatment <span class="math inline">\(X\)</span> for six individuals. Question marks indicate missing data.
</figcaption>
<div aria-describedby="tbl-missing-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">\(i\)</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">\(X_i\)</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">\(Y_i(0)\)</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">\(Y_i(1)\)</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">\(Y_i(1)-Y_i(0)\)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">?</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">?</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">?</td>
<td style="text-align: center;">?</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">?</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">?</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">?</td>
<td style="text-align: center;">?</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">?</td>
<td style="text-align: center;">?</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">?</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">?</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<p>We are effectively comparing the distribution of the outcome variable <span class="math inline">\((Y \mid X)\)</span> for different values of the experimental treatment set <span class="math inline">\(X\)</span> (more generally, these are referred to as action sets). We talk about causation when for treatment (<span class="math inline">\(X=j\)</span>) and control (<span class="math inline">\(X=0\)</span>), the distributions of <span class="math inline">\((Y \mid X=j)\)</span> differs from that of <span class="math inline">\((Y \mid X=0)\)</span>, as illustrated in <a href="#fig-dist" class="quarto-xref">Figure&nbsp;<span>13.2</span></a>. We must thus resort to population-level estimates by considering averages and other summaries to draw inferences.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dist" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="causal-inference_files/figure-html/fig-dist-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.2: Distribution of response on a seven point Likert scale for treatment and control groups in an hypothetical population.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Rather than look at the individual treatment effect difference, we can focus on averages over the population. The most common measure of causation is the <strong>average treatment effect</strong>, which is the difference between the population averages of treatment group <span class="math inline">\(X=j\)</span> and the control group <span class="math inline">\(X=0\)</span>, <span class="math display">\[\begin{align*}
\textsf{ATE}_j = \underset{\substack{\text{expected response among}\\\text{treatment group $j$}}}{\mathsf{E}(Y \mid X=j)} - \underset{\substack{\text{expected response among}\\\text{control group}}}{\mathsf{E}(Y \mid X=0)}
\end{align*}\]</span> which is a valid estimator of <span class="math inline">\(\mathsf{E}\{Y(j) - Y(0)\}\)</span> provided that <span class="math inline">\(X\)</span> is randomly allocated.</p>
<p>What assumptions are necessary to draw causal conclusion? In an experimental setting, we need the following:</p>
<ol type="1">
<li>conditional <em>ignorability</em>, which states that potential outcomes are independent (denoted with the <span class="math inline">\({\perp\mkern-10mu\perp}\)</span> symbol) of assignment to treatment given a set of explanatories <span class="math inline">\(\boldsymbol{Z}.\)</span> In notation <span class="math inline">\(\{Y(0), \ldots, Y(J)\}\ {\perp\mkern-10mu\perp}\ X \mid \boldsymbol{Z}\)</span> (if the latter is an empty set, we talk about ignorability).</li>
<li>lack of interference: the outcome is unaffected by the treatment assignment of other participants.</li>
<li>consistency: given a treatment <span class="math inline">\(X\)</span> taking level <span class="math inline">\(j\)</span>, the observed value for the response <span class="math inline">\(Y \mid X=j\)</span> is equal to the corresponding potential outcome <span class="math inline">\(Y(j)\)</span>.</li>
</ol>
<p>The two last assumptions are sometimes pooled together under the umbrella term <strong>stable unit-treatment value assumption</strong> (SUTVA), implying that ‘’no other version or treatment assignment would lead to different potential outcome’’ <span class="citation" data-cites="Imbens.Rubin:2015">(<a href="references.html#ref-Imbens.Rubin:2015" role="doc-biblioref">Imbens and Rubin 2015</a>)</span>, which also suggests the effect of treatment is constant.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Conditional ignorability for observational data
</div>
</div>
<div class="callout-body-container callout-body">
<p>Causal inference is possible in observational settings, but some of the assumptions are unverifiable and typically much stronger than for randomized experiments. Notably, we need to identify a sufficient set of confounders <span class="math inline">\(\boldsymbol{Z}\)</span>, i.e., variables which cause both <span class="math inline">\(X\)</span> and the outcome <span class="math inline">\(Y\)</span> but are not of interest, to incorporate in the model to recover the effect due to <span class="math inline">\(X\)</span>. We can then look effect averaging over the distribution of <span class="math inline">\(\boldsymbol{Z}\)</span>. This method is valid as long as there is a positive probability of being assigned to each group of <span class="math inline">\(X\)</span> regardless of the value of the covariates <span class="math inline">\(\boldsymbol{Z}\)</span>, an assumption sometimes known as positivity. The model must also be correctly specified, and there must be no omitted confounders.</p>
</div>
</div>
<p>In summary, we can estimate the average treatment effect in experimental designs if we randomize the effect <span class="math inline">\(X=j,\)</span> if our subjects comply with their treatment assignment, and more importantly if we use a random sample which is representative of the population.</p>
<div id="exm-nonrandomtreatment" class="theorem example">
<p><span class="theorem-title"><strong>Example 13.1</strong></span> The <a href="https://www.hec.ca/programmes/baccalaureats/parcours-agir/index.html">Agir cohort</a> offers a comprehensive experience for the first three trimesters of the bachelor in administration program. These students take the same exams as regular students, but their class average are higher in the mandatory statistics course. However, since participation in the program is reserved for students who postulated to be part of the cohort, and who must be team players who are autonomous and with a keen liking for inverse pedagogical teaching methods, no conclusion can be drawn. Indeed, it may be that the teaching method is well suited to them but not to general students, or their better grades may be due to the fact that the Agir students are more motivated or stronger in statistics to being with.</p>
<p>If we compared the outcome of regular bachelor cohort with Agir students, we may also have violation of “no interference”: if students from different programs share course material or study together, then this lack of compliance may induce differences in response relative to their group assignment.</p>
</div>
<p>In many fields, the unconditional effect is not interesting enough to warrant publication free of other explanatory variables. It may be that the effect of the treatment is not the same for everyone and depends on some covariate <span class="math inline">\(Z:\)</span> for example, a study on gender discrimination may reveal different perceptions depending on gender <span class="math inline">\(Z,\)</span> in which case the average treatment effect might not be a sensible measure and we could look at conditional effects. We may also be interested in seeing how different mechanisms and pathways are impacted by treatment and how this affects the response. <!--
The conditional average treatment effect looks at the average difference
\begin{align*}
\textsf{CATE}_j = \mathsf{E}(Y \mid X=j, Z = z) - \mathsf{E}(Y \mid X=0, Z = z)
\end{align*}
--> <span class="citation" data-cites="Vanderweele:2015">VanderWeele (<a href="references.html#ref-Vanderweele:2015" role="doc-biblioref">2015</a>)</span> provides an excellent non-technical overview of mediation and interaction.</p>
<section id="directed-acyclic-graph" class="level3" data-number="13.1.1">
<h3 data-number="13.1.1" class="anchored" data-anchor-id="directed-acyclic-graph"><span class="header-section-number">13.1.1</span> Directed acyclic graph</h3>
<!--
TODO: write about conditional average treatment effect (CATE) and local average treatment effect. Discuss noncompliance and potential selection effects (selection on colliders)
-->
<p>Causal inference requires a logical conceptual model of the interrelation between the variables. We will look at directed acyclic graphs to explain concepts of confounding, collision and mediation and how they can influence our conclusions.</p>
<p>To illustrate the relationship between variables, we use diagrams consisting of directed acyclic graph (DAG). A graph is a set of nodes and vertices: each node represents a variable of interest and these are linked with directed edges indicating the nature of the relation (if <span class="math inline">\(X\)</span> causes <span class="math inline">\(Y\)</span>, then <span class="math inline">\(X \to Y\)</span>). The acyclic simply forbids loops: if <span class="math inline">\(X\)</span> causes <span class="math inline">\(Y\)</span>, then <span class="math inline">\(Y\)</span> cannot cause <span class="math inline">\(X\)</span> (typically, violations are due to time dependence, which means that we must consider a larger DAG where <span class="math inline">\(Y\)</span> is indexed by time, for example when medical treatment can cause changes in condition, which themselves trigger different treatments.</p>
<p>Directed acyclic graphs are used to represent the data generating process that causes interdependencies between variables, while abstracting from the statistical description of the model. This depiction of the conceptual model helps to formalize and identify the assumptions of the model. To identify a causal effect of a variable <span class="math inline">\(X\)</span> on some response <span class="math inline">\(Y\)</span>, we need to isolate the effect from that of other potential causes. <a href="#fig-daggity" class="quarto-xref">Figure&nbsp;<span>13.3</span></a> shows an example of DAG in a real study; the latter is a simplification or abstraction of a world view, but is rather complicated.</p>
<!--https://bookdown.org/mike/data_analysis/causal-inference.html-->
<div class="cell">
<div class="cell-output-display">
<div id="fig-daggity" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-daggity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/dagitty-model.png" class="img-fluid figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-daggity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.3: Directed acyclic graph of <span class="citation" data-cites="McQuire:2020">McQuire et al. (<a href="references.html#ref-McQuire:2020" role="doc-biblioref">2020</a>)</span> reproduction by <a href="https://www.andrewheiss.com/">Andrew Heiss</a>, licensed under <a href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>At a theoretical level, the DAG will help identify which paths and relations to control through conditioning arguments to strip the relation to that of interest. Judea Pearl <span class="citation" data-cites="Pearl:2016">(e.g., <a href="references.html#ref-Pearl:2016" role="doc-biblioref">Pearl, Glymour, and Jewell 2016</a>)</span> identifies three potential relations between triples of (sets of) variables:</p>
<ul>
<li>chains (<span class="math inline">\(X \to Z\to Y\)</span>),</li>
<li>forks (<span class="math inline">\(Z \leftarrow X \rightarrow Y\)</span>) and</li>
<li>reverse forks (<span class="math inline">\(Z \rightarrow X \leftarrow Y\)</span>).</li>
</ul>
<p>These are represented in <a href="#fig-causalrelations" class="quarto-xref">Figure&nbsp;<span>13.4</span></a>. In the graph, <span class="math inline">\(X\)</span> represents an explanatory variable, typically the experimental factor, <span class="math inline">\(Y\)</span> is the response and <span class="math inline">\(Z\)</span> is another variable whose role depends on the logical flow between variables (collider, confounder or mediator).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-causalrelations" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-causalrelations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/causal_dag_aheiss.jpg" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-causalrelations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.4: Type of causal relations by Andrew Heiss, licensed under <a href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In an experimental design, confounding effects from the experimental treatment <span class="math inline">\(X\)</span> to the response <span class="math inline">\(Y\)</span> are controlled by randomization or sample selection: all incoming arrows inside <span class="math inline">\(X\)</span> from other variables are removed. If we include additional variables in the model which happen to be colliders, then we won’t recover the causal effect of interest. Addition of mediators will let us filter the effect due to <span class="math inline">\(Z\)</span> from the direct effect of <span class="math inline">\(X\)</span>.</p>
<p>It is <em>essential</em> to determine via logic or otherwise (experiments can help!) the direction of the relationship, lest we run into trouble. Many statistical models commonly used, including regression models, cannot provide an answer to a problem that is philosophical or conceptual in nature. Indeed, correlation is symmetric and insufficient to infer the direction of the arrows in the directed acyclic graph.</p>
<p>The conclusions we will draw from statistical models depend on the nature of the relation. For example, in an observational setting, we could eliminate the effect of a confounding variable by controlling in a regression model, matching or by stratifying for different values of the confounders in order to extract the causal estimate of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>. Matching consists in creating paired samples (with similar characteristics for explanatories), and comparing the pairs. Stratification consists of analysing subpopulations separately.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution about the kitchen sink approach
</div>
</div>
<div class="callout-body-container callout-body">
<p>Controlling for a collider is counterproductive, as we would get erroneous conclusions: <span class="citation" data-cites="Kowal:2021">Kowal (<a href="references.html#ref-Kowal:2021" role="doc-biblioref">2021</a>)</span> reportedly claimed married couples with more children were less happy. As Richard McElreath hinted online, controlling for marriage (through sample selection) is incorrect since unhappy couples tend to divorce, but families with many children are less likely to divorce.</p>
</div>
</div>
</section>
</section>
<section id="mediation" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="mediation"><span class="header-section-number">13.2</span> Mediation</h2>
<p>We need to add to our logical causal model represented by a directed acyclic graph data generating mechanisms that prescribes how variables how interrelated. Our ability to establish mediation will depend on the model and a set of assumptions, some of which won’t be verifiable.</p>
<p>To define in full generality the treatment and mediation effect, we consider the potential outcome framework. Following <span class="citation" data-cites="Pearl:2014">Pearl (<a href="references.html#ref-Pearl:2014" role="doc-biblioref">2014</a>)</span>, we use the notation <span class="math inline">\(\text{do}(X=x)\)</span> is used to denote experimental manipulation of <span class="math inline">\(X\)</span>, to distinguish it from correlation in observational data. The resulting potential outcome for individual <span class="math inline">\(i\)</span> is <span class="math inline">\(Y_i(x, m)\)</span>, with explanatory or experimental covariate/factor <span class="math inline">\(x\)</span> and mediator <span class="math inline">\(m\)</span>. Likewise, <span class="math inline">\(M_i(x)\)</span> is the potential mediator when applying treatment level <span class="math inline">\(x\)</span>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Value <span class="math inline">\(x_0\)</span> represents the baseline or control value for our experimental manipulation.</p>
<div id="def-ate" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 13.1 (Average total, conditional mediation and direct effects)</strong></span> For simplicity, we focus on binary treatment with <span class="math inline">\(X_i \in \{0,1\}\)</span>, with <span class="math inline">\(X_i=x_0=0\)</span> the control and <span class="math inline">\(X=1\)</span> for treatment. Until now, we have considered experiments in which we randomly allocate participants to groups, so we recovered the overall effect of treatment abstracting from other variables. The following definitions are standard, e.g. <span class="citation" data-cites="Robins.Greenland:1992">Robins and Greenland (<a href="references.html#ref-Robins.Greenland:1992" role="doc-biblioref">1992</a>)</span>, <span class="citation" data-cites="Pearl:2014">Pearl (<a href="references.html#ref-Pearl:2014" role="doc-biblioref">2014</a>)</span>, <span class="citation" data-cites="Imai:2010">Imai, Keele, and Tingley (<a href="references.html#ref-Imai:2010" role="doc-biblioref">2010</a>)</span>.</p>
<p>The <strong>average directed effect</strong> measures the flow along <span class="math inline">\(X \rightarrow Y\)</span>, disabling the pathway <span class="math inline">\(X \to M \to Y\)</span> by fixing the mediator value: it is <span class="math display">\[\begin{align*}
\mathsf{ADE}(x) &amp;=
\mathsf{E}[Y_i \mid \text{do}\{X=1, M=M_i(x)\}] - \mathsf{E}[Y_i \mid \text{do}\{X=0, M=M_i(x)\}] \\&amp;= \mathsf{E}[Y_i(1,M_i(x)) -Y_i(0, M_i(x))\}
\end{align*}\]</span> This measures the expected change in response when the experimental factor changes from treatment to control, while the mediator is set to a fixed value <span class="math inline">\(M_i(x)\)</span> uniformly over the population. Fixing the mediator, which may or not be feasible experimentally.</p>
<p>The <strong>average causal mediation effect</strong> (also called indirect effect), is the main quantity of interest in mediation analysis. It is obtained by looking at changes in the outcome for a fixed intervention due to changing the values of the mediator to those it would take under the treatment and control group, respectively <span class="math inline">\(M_i(1)\)</span> and <span class="math inline">\(M_i(0)\)</span>. <span class="math display">\[\begin{align*}
\mathsf{ACME}(x) &amp;=
\mathsf{E}[Y_i \mid \text{do}\{X=x, M=M_i(1)\}] - \mathsf{E}[Y_i \mid \text{do}\{X=x, M=M_i(0)\}] \\&amp;= \mathsf{E}[Y_i\{x, M_i(1)\} -Y_i\{x, M_i(0)\}]
\end{align*}\]</span></p>
<p>The <strong>total effect</strong> measures the average overall impact of changes in outcome <span class="math inline">\(Y\)</span> (both through <span class="math inline">\(M\)</span> and directly) when experimentally manipulating <span class="math inline">\(X\)</span>, <span class="math display">\[\begin{align*}
\mathsf{TE}_i &amp;= \mathsf{E}[ Y_i \mid \text{do}(X=1)] - \mathsf{E}[ Y_i \mid \text{do}(X=0)]
\\ &amp;= \mathsf{E}[Y_i\{1, M(1)\}] - \mathsf{E}[Y_i\{0, M(0)\}],
\end{align*}\]</span> This is what we retrieve if we randomize treatment assignment and consider the average change in average response. The total effect is obtained as <span class="math inline">\(\mathsf{TE} = \mathsf{ACME}(X) + \mathsf{ADE}(1-X)\)</span> for <span class="math inline">\(X=0,1.\)</span> If there is no interaction between the treatment and the mediator, then the values of the average causal mediation effect and the average direct effect are the same regardless of the treatment assignment <span class="math inline">\(x\)</span>.</p>
</div>
<div id="def-sutva" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 13.2 (Sequential ignorability assumption for mediation)</strong></span> To draw valid conclusions and build suitable estimation procedures, we need an assumption which can be decomposed into two components. The first component is: given pre-treatment covariates <span class="math inline">\(Z\)</span>, treatment assignment is independent of potential outcomes for mediation and outcome, <span class="math display">\[\begin{align*}
Y_i(x', m), M_i(x) {\perp\mkern-10mu\perp} X_i \mid \boldsymbol{Z}_i = \boldsymbol{z}.
\end{align*}\]</span> In order words, the values taken by the mediator and by the response exist independently of the treatment assignment and don’t change.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>The second component of the sequential ignorability assumption is as follows: given pre-treatment covariates and observed treatment, mediation is independent of potential outcomes, <span class="math display">\[\begin{align*}
Y_i(x', m) \perp\mkern-10mu\perp  M_i(x) \mid X_i =x, \boldsymbol{Z}_i = \boldsymbol{z}
\end{align*}\]</span> The set of assumptions from <span class="citation" data-cites="Imai:2010">Imai, Keele, and Tingley (<a href="references.html#ref-Imai:2010" role="doc-biblioref">2010</a>)</span> and <span class="citation" data-cites="Pearl:2014">Pearl (<a href="references.html#ref-Pearl:2014" role="doc-biblioref">2014</a>)</span> are equivalent under randomization of treatment assignment, as we consider thereafter.</p>
<p>We assume also that any value of <span class="math inline">\(X\)</span> given covariates <span class="math inline">\(\boldsymbol{Z}\)</span> is possible (which is trivially satisfied when randomizing with equal probability), and that likewise any value of the mediator <span class="math inline">\(M\)</span> is possible for any combination of covariates <span class="math inline">\(\boldsymbol{Z}\)</span> and treatment assignement <span class="math inline">\(X\)</span>.</p>
<!-- The total effect can be written  -->
<!-- $$\mathsf{TE}(x, x_0) = \mathsf{NDE}(x, x_0) - \mathsf{NIE}(x_0, x).$$ -->
<!-- In the linear mediation model, the reversal of argument amounts to changing the sign of the coefficient, giving an additive decomposition of the total effect as $\mathsf{TE} = \mathsf{NDE} + \mathsf{NIE}$ [@Pearl:2014].  -->
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Measurement error
</div>
</div>
<div class="callout-body-container callout-body">
<p>When measuring effects in psychology and marketing, it will often be the case that the conceptual causal model includes variables that cannot be directly measured. Proxies, as in <a href="#fig-xkcd2652" class="quarto-xref">Figure&nbsp;<span>13.5</span></a>, add an additional layer of complexity and potential sources of confounding.</p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-xkcd2652" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-xkcd2652-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/xkcd2652_proxy_variable.png" class="img-fluid figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-xkcd2652-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.5: xkcd comic <a href="https://xkcd.com/2652/">2652 (Proxy Variable) by Randall Munroe</a>. Alt text: Our work has produced great answers. Now someone just needs to figure out which questions they go with. Cartoon reprinted under the <a href="https://creativecommons.org/licenses/by-nc/2.5/">CC BY-NC 2.5 license</a>.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="linear-mediation-model" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="linear-mediation-model"><span class="header-section-number">13.3</span> Linear mediation model</h2>
<p>One of the most popular model in social sciences is the linear mediation model, popularized by <span class="citation" data-cites="Baron.Kenny:1986">Baron and Kenny (<a href="references.html#ref-Baron.Kenny:1986" role="doc-biblioref">1986</a>)</span>. Hayes’ <a href="https://www.processmacro.org/index.html">PROCESS macros for SAS, SPSS and <strong>R</strong></a> have lead to the widespread adoption by researchers <span class="citation" data-cites="Preacher.Hayes:2004">(<a href="references.html#ref-Preacher.Hayes:2004" role="doc-biblioref">Preacher and Hayes 2004</a>)</span>. <span class="citation" data-cites="Bullock.Green.Ha:2010">Bullock, Green, and Ha (<a href="references.html#ref-Bullock.Green.Ha:2010" role="doc-biblioref">2010</a>)</span> list limitations of the approach and provide examples in which the model does not have a meaningful causal interpretation.</p>
<p>The linear mediation model assumes that the effect of mediation and treatment is additive and that the response measurement is continuous. Consider an experimental factor <span class="math inline">\(X\)</span> corresponding to treatments with control or reference <span class="math inline">\(x_0\)</span> and postulated mediator variable <span class="math inline">\(M\)</span>, assumed continuous. Given <strong>uncorrelated</strong> unobserved noise variables <span class="math inline">\(\varepsilon_M\)</span> and <span class="math inline">\(\varepsilon_Y\)</span>, we specify linear regression models, <span class="math display">\[\begin{align*}
M \mid X=x &amp;= c_M + \alpha x + \varepsilon_M,\\
Y \mid X=x, M=m &amp;=  c_Y + \beta x + \gamma m  + \varepsilon_Y
\end{align*}\]</span> where we use the contrasts parametrization, so that the reference category for the intercept corresponds to control (group <span class="math inline">\(x_0\)</span>) and <span class="math inline">\(x\)</span> the other category of interest, with <span class="math inline">\(\alpha\)</span> capturing the difference between <span class="math inline">\(x\)</span> and <span class="math inline">\(x_0\)</span>. The model for <span class="math inline">\(Y \mid X, M\)</span> should include additional covariates <span class="math inline">\(\mathbf{z}\)</span> to control for confounding between <span class="math inline">\(M\)</span> and <span class="math inline">\(Y\)</span> if the latter is suspected.</p>
<p>The average value for <span class="math inline">\(M(1) = c_M + \alpha\)</span> and that of <span class="math inline">\(M(0)=c_M\)</span>. If we substitute the first equation in the second equation, we get that <span class="math display">\[\begin{align*}
\mathsf{ACME}(x) &amp;= \mathsf{E}[Y\{x, M(1)\} -Y\{x, M(0)\}] = \alpha \gamma\\
\mathsf{ADE}(x) &amp;= \mathsf{E}[Y\{1, M(x)\} -Y\{0, M(x)\}] = \beta \\
\mathsf{TE} &amp;= \mathsf{E}[Y\{1, M(1)\} -Y\{0, M(0)\}] = \beta + \alpha \gamma
\end{align*}\]</span></p>
<p>The parameters can be interpreted as the direct (<span class="math inline">\(\beta\)</span>), conditional mediation effect (<span class="math inline">\(\alpha \gamma\)</span>) and total (<span class="math inline">\(\beta + \alpha \gamma\)</span>) effects. These parameters can be estimated using structural equation models (SEM), or more typically by running a series of linear regression.</p>
<p>The “sequential ignorability” assumption in the linear mediation models boils down to “no unmeasured confounders” in the relations <span class="math inline">\(X \to Y\)</span>, <span class="math inline">\(X \to M\)</span> and <span class="math inline">\(M \to Y\)</span>: the first two are satisfied in experimental studies due to randomization if we can manipulate <span class="math inline">\(X\)</span>, as shown in <a href="#fig-dag1" class="quarto-xref">Figure&nbsp;<span>13.8</span></a>. This means <span class="math inline">\(\varepsilon_M\)</span> and <span class="math inline">\(\varepsilon_Y\)</span> must be independent of one another and, as a result, error terms should also be uncorrelated.</p>
<p>In the linear mediation model, we can estimate the conditional direct effect corresponding to the product of coefficients <span class="math inline">\(\alpha\gamma\)</span>. Absence of mediation implies the product is zero. <span class="citation" data-cites="Baron.Kenny:1986">Baron and Kenny (<a href="references.html#ref-Baron.Kenny:1986" role="doc-biblioref">1986</a>)</span> recommended using Sobel’s test statistic, of the form <span class="math display">\[\begin{align*}
S  &amp;= \frac{\widehat{\alpha}\widehat{\gamma} - 0}{\mathsf{se}(\widehat{\alpha}\widehat{\gamma})} \\&amp;=  \frac{\widehat{\alpha}\widehat{\gamma}}{\sqrt{\widehat{\gamma}^2\mathsf{Va}(\widehat{\alpha}) + \widehat{\alpha}^2\mathsf{Va}(\widehat{\gamma}) + \mathsf{Va}(\widehat{\gamma})\mathsf{Va}(\widehat{\alpha})}}
\end{align*}\]</span> where <span class="math inline">\(\widehat{\alpha}\)</span>, <span class="math inline">\(\widehat{\gamma}\)</span> and their variance <span class="math inline">\(\mathsf{Va}(\widehat{\alpha})\)</span> and <span class="math inline">\(\mathsf{Va}(\widehat{\gamma})\)</span> can be obtained from the estimated coefficients and standard errors.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> The Sobel’s statistic <span class="math inline">\(S\)</span> is approximately standard normal in large samples, <span class="math inline">\(S \stackrel{\cdot}{\sim}\mathsf{Normal}(0,1)\)</span>, but the approximation is sometimes poor in small samples. Other test statistics are listed in <span class="citation" data-cites="McKinnon:2002">MacKinnon et al. (<a href="references.html#ref-McKinnon:2002" role="doc-biblioref">2002</a>)</span>.</p>
<div id="exm-sobel" class="theorem example">
<p><span class="theorem-title"><strong>Example 13.2 (Null distribution of Sobel statistic)</strong></span> To see this, let’s generate data with a binary treatment and normally distributed mediators and response with no confounding, so that the data generating process matches exactly the formulation of Baron–Kenny. We set <span class="math inline">\(\alpha=2\)</span>, <span class="math inline">\(\beta = 1/2\)</span> and <span class="math inline">\(\gamma=0\)</span>. This is an instance where the null hypothesis is true (<span class="math inline">\(X\)</span> affects both <span class="math inline">\(M\)</span> and <span class="math inline">\(Y\)</span>, but there is no mediation effect).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-sobelsimu" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sobelsimu-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="causal-inference_files/figure-html/fig-sobelsimu-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sobelsimu-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.6: Null distribution of Sobel’s statistic against approximate asymptotic normal distribution with 20 observations <span class="math inline">\(\alpha=0\)</span>, <span class="math inline">\(\gamma=0.1\)</span> and normal random errors.
</figcaption>
</figure>
</div>
</div>
</div>
<p>If we knew exactly the model that generated <span class="math inline">\(X\)</span>, <span class="math inline">\(M\)</span>, <span class="math inline">\(Y\)</span> and the relations between them, we could simulate multiple datasets like in <a href="#fig-sobelsimu" class="quarto-xref">Figure&nbsp;<span>13.6</span></a> with <span class="math inline">\(n=20\)</span> observations and compare the test statistic we obtained with the simulation-based null distribution with <span class="math inline">\(\alpha\gamma=0\)</span>. In practice we do not know the model that generated the data and furthermore we have a single dataset at hand.</p>
</div>
<p>In the linear mediation causal model, we can estimate the total causal effect of <span class="math inline">\(X\)</span>, labelled <span class="math inline">\(\tau\)</span>, by running the linear regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(X\)</span> as there is no confounding affecting treatment <span class="math inline">\(X\)</span> in a completely randomized experimental design. This strategy isn’t valid with observational data unless we adjust for confounders.</p>
<div id="rem-histnote" class="proof remark">
<p><span class="proof-title"><em>Remark 13.1</em> (Historical note on Baron and Kenny). </span><span class="citation" data-cites="Baron.Kenny:1986">Baron and Kenny (<a href="references.html#ref-Baron.Kenny:1986" role="doc-biblioref">1986</a>)</span> suggested for <span class="math inline">\(M\)</span> and <span class="math inline">\(Y\)</span> continuous breaking down the task in three separate steps:</p>
<ol type="1">
<li>fit a linear regression of <span class="math inline">\(M\)</span> on <span class="math inline">\(X\)</span> to estimate <span class="math inline">\(\alpha\)</span></li>
<li>fit a linear regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(X\)</span> and <span class="math inline">\(M\)</span> to estimate <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\gamma\)</span>.</li>
<li>fit a linear regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(X\)</span> to estimate <span class="math inline">\(\tau\)</span></li>
</ol>
<p>In the “<span class="citation" data-cites="Baron.Kenny:1986">Baron and Kenny (<a href="references.html#ref-Baron.Kenny:1986" role="doc-biblioref">1986</a>)</span> approach”, we test <span class="math inline">\(\mathscr{H}_0: \alpha=0\)</span>, <span class="math inline">\(\mathscr{H}_0: \tau=0\)</span> and <span class="math inline">\(\mathscr{H}_0: \gamma=0\)</span> against the two-sided alternative. This approach is somewhat flawed since mediation refers to the relation <span class="math inline">\(X \to M \to Y\)</span>, so we only need to consider (joint tests of) <span class="math inline">\(\alpha\gamma\)</span> (the total effect could be zero because <span class="math inline">\(\beta = -\alpha\gamma\)</span> even if there is mediation). In practice, thus, we only need steps 1) and 2) and the models should include potential confounders of the pair <span class="math inline">\((M, Y)\)</span>.</p>
</div>
<div id="def-typology" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 13.3 (Typology of mediation)</strong></span> The following characterization was proposed by <span class="citation" data-cites="Zhao.Lynch.Chen:2010">Zhao, Lynch, and Chen (<a href="references.html#ref-Zhao.Lynch.Chen:2010" role="doc-biblioref">2010</a>)</span>:</p>
<ol type="1">
<li>complementary mediation when both direct and indirect effects are of the same sign and non-zero.</li>
<li>competitive mediation when direct and indirect effects are of opposite signs.</li>
<li>indirect-only mediation when the direct effect of <span class="math inline">\(X \to Y\)</span> is null, but the effect <span class="math inline">\(X \to M \to Y\)</span> isn’t.</li>
</ol>
<p>Previous definitions popularized by <span class="citation" data-cites="Baron.Kenny:1986">Baron and Kenny (<a href="references.html#ref-Baron.Kenny:1986" role="doc-biblioref">1986</a>)</span> still found in old papers include “full mediation” for instances where <span class="math inline">\(\beta=0\)</span> and partial mediation if the direct effect is less than the total effect, meaning <span class="math inline">\(\beta &lt; \tau\)</span>.</p>
</div>
<section id="nonparametric-bootstrap" class="level3" data-number="13.3.1">
<h3 data-number="13.3.1" class="anchored" data-anchor-id="nonparametric-bootstrap"><span class="header-section-number">13.3.1</span> Nonparametric bootstrap</h3>
<p>An alternative for inference to large-sample approximations to the null distribution used as benchmark to establish whether a test statistic is ‘large’ is the bootstrap, a form of simulation-based inference <span class="citation" data-cites="Efron:1979">(<a href="references.html#ref-Efron:1979" role="doc-biblioref">Efron 1979</a>)</span>. The latter is conceptually easy to understand: we generate new datasets by resampling from the ones observed (as if it was the population). Since we want the sample size to be identical and our objective is to get heterogeneity, we sample with replacement: from one bootstrap dataset to the next, we will have multiple copies, or none, of each observation. See <span class="citation" data-cites="Efron.Tibshirani:1993">Efron and Tibshirani (<a href="references.html#ref-Efron.Tibshirani:1993" role="doc-biblioref">1993</a>)</span> and <span class="citation" data-cites="Davison.Hinkley:1997">Davison and Hinkley (<a href="references.html#ref-Davison.Hinkley:1997" role="doc-biblioref">1997</a>)</span> for a more thorough treatment of the bootstrap and alternative sampling schemes for regression models. The nonparametric bootstrap procedure advocated by <span class="citation" data-cites="Preacher.Hayes:2004">Preacher and Hayes (<a href="references.html#ref-Preacher.Hayes:2004" role="doc-biblioref">2004</a>)</span> consists in repeating the following <span class="math inline">\(B\)</span> times:</p>
<ol type="1">
<li>sample <span class="math inline">\(n\)</span> observations <strong>with replacement</strong>, i.e., a tuple (<span class="math inline">\(X_i, M_i, Y_i)\)</span>, from the original data .</li>
<li>compute the natural indirect effect <span class="math inline">\(\widehat{\alpha}\cdot\widehat{\gamma}\)</span> on each simulated sample</li>
</ol>
<p>There are different approaches to computing confidence intervals, but the simplest is the <strong>percentile method</strong>. For a two-sided test at level <span class="math inline">\(\alpha\)</span>, compute the <span class="math inline">\(\alpha/2\)</span> and <span class="math inline">\(1-\alpha/2\)</span> quantiles of the bootstrap statistics <span class="math inline">\(\{\widehat{\alpha}_b\widehat{\gamma}_b\}_{b=1}^B\)</span>. For example, if the level is <span class="math inline">\(\alpha=5\)</span>% and we generate <span class="math inline">\(B=1000\)</span> bootstrap samples, the percentile confidence intervals bounds are the 25th and 975th ordered observations.</p>
<p>Nowadays, the asymptotic approximation (sometimes misnamed delta method<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>) has fallen out of fashion among practitioners for getting confidence intervals for the ACME (not Sobel’s statistic), who prefer the nonparametric bootstrap coupled with the percentile method. <a href="#fig-bootstrap" class="quarto-xref">Figure&nbsp;<span>13.7</span></a> shows that the sampling distribution of <span class="math inline">\(\widehat{\alpha}\widehat{\gamma}\)</span> (unstandardized) is indeed not symmetric, unlike the distribution of Sobel’s statistic.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-bootstrap" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-bootstrap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="causal-inference_files/figure-html/fig-bootstrap-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bootstrap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.7: Bootstrap distribution of average conditional mediation effect (aka indirect effect) with estimate and percentile 95% confidence intervals (vertical red lines) for the simulated example.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The nonparametric percentile bootstrap confidence interval for <span class="math inline">\(\alpha\gamma\)</span> is <span class="math inline">\([-0.08, 1.71]\)</span> and thus we fail to reject the null hypothesis <span class="math inline">\(\mathscr{H}_0: \alpha \gamma=0\)</span>.</p>
</section>
</section>
<section id="model-assumptions" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="model-assumptions"><span class="header-section-number">13.4</span> Model assumptions</h2>
<p>We can unpack the model assumptions for the linear mediation model.</p>
<ol type="1">
<li>The <em>no unmeasured confounders</em> assumption. Plainly stated, there are no unobserved confounders and thus the error terms <span class="math inline">\(\varepsilon_M\)</span> and <span class="math inline">\(\varepsilon_Y\)</span> are independent. Additionally, when we consider observational data, we must make sure there is hidden confounders affecting either the <span class="math inline">\(M \to X\)</span> and the <span class="math inline">\(X \to Y\)</span> relation, as shown in <a href="#fig-dag1" class="quarto-xref">Figure&nbsp;<span>13.8</span></a>. We can include covariates in the regression models to palliate to this, but we must only include the minimal set of confounders (and no additional mediator or collider chain).</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/dag1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.8: Directed acyclic graph representing observational settings (left) and experimental settings in which assignment is random given covariates measured pre-treatments (right). The ‘no unmeasured confounder’ assumption postulates such confounders are included (with the correct parametric form) in the regression models.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Another problem would be to claim that variable <span class="math inline">\(M\)</span> is a mediator when in truth part of the effect on the outcome is due to change in another mediator. <a href="#fig-dag2" class="quarto-xref">Figure&nbsp;<span>13.9</span></a> shows an instance with no confounding, but multiple mediators, say <span class="math inline">\(M_1\)</span> and <span class="math inline">\(M_2\)</span>: the latter mediates the relation <span class="math inline">\(M_1 \to Y\)</span>. The linear mediation model would capture the total effect of <span class="math inline">\(M_1\)</span>, but it would be incorrect to claim that the mediation effect on <span class="math inline">\(X\)</span> is due to <span class="math inline">\(M_1\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/dag2.png" class="img-fluid figure-img" style="width:40.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.9: Directed acyclic graph showing multiple mediators.
</figcaption>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>The <strong>linearity assumption</strong> implies that the linear models are correctly specified and that the effect of the covariates are linear. This means that, <em>ceteris paribus</em>, the effect of an increase of one unit of <span class="math inline">\(M\)</span> on <span class="math inline">\(Y\)</span> is the same regardless of the value of <span class="math inline">\(M\)</span>. It also doesn’t depend on the level of other variables (no interaction). If the model isn’t properly specified, the linear model coefficients will capture the best linear predictor given the design and the coefficients may not be meaningful. There must thus be no interaction between treatment and the mediator; see <a href="#def-moderated-mediation" class="quarto-xref">Definition&nbsp;<span>13.4</span></a> for the relaxation.</li>
</ol>
<p>The linearity assumption also implies that the effect is the same for every individual, so there is no treatment heterogeneity or measurement error which could lead to attenuation bias.</p>
<p>Following <span class="citation" data-cites="Bullock.Green.Ha:2010">Bullock, Green, and Ha (<a href="references.html#ref-Bullock.Green.Ha:2010" role="doc-biblioref">2010</a>)</span>, we index the regression equations by individual <span class="math inline">\(i\)</span> <span class="math display">\[\begin{align*}
M_i\mid X_i=x &amp;= c_M + \alpha_i x + \varepsilon_{M,i},\\
Y_i \mid X_i=x, M_i=m &amp;=  c_Y + \beta_i x + \gamma_i m + \varepsilon_{Y,i}
\end{align*}\]</span> If <span class="math inline">\(\alpha_i\)</span> differ from one observation to the next, the average estimated by the regression could be positive, negative or null. Even in the latter case, we could have <span class="math inline">\(\gamma_i\)</span> and <span class="math inline">\(\alpha_i\)</span> positive for some observation, or both negatives so that they cancel out even if there is complementary mediation.</p>
<p>The main benefit of experimental designs is that it remove confounding in the relationship between treatment and other variables. Adding spurious variables could create feedback (if some of those variables are colliders) and lead to inconsistent conclusions. It’s not clear that the mediator can be manipulated experimentally, and even if it could be to estimate the <span class="math inline">\(\gamma\)</span>, one must make sure the relation is the same absent of <span class="math inline">\(X\)</span>. For example, we could estimate the indirect effect term by manipulating jointly (if possible) (<span class="math inline">\(X, M\)</span>) but even then the linearity assumption must hold for the estimates to correspond to our linear causal mediation model.</p>
<section id="sensitivity-analysis" class="level3" data-number="13.4.1">
<h3 data-number="13.4.1" class="anchored" data-anchor-id="sensitivity-analysis"><span class="header-section-number">13.4.1</span> Sensitivity analysis</h3>
<p>The no-unmeasured confounders assumption should be challenged. One way to assess the robustness of the conclusions to this is to consider correlation between errors, as in <span class="citation" data-cites="Bullock.Green.Ha:2010">Bullock, Green, and Ha (<a href="references.html#ref-Bullock.Green.Ha:2010" role="doc-biblioref">2010</a>)</span>. Indeed, one can show that the average parameter in the equation for the response of the linear mediation model satisfies <span class="math display">\[\begin{align*}
\mathsf{E}(\widehat{\gamma})= \gamma + \frac{\mathsf{Cov}(\varepsilon_m, \varepsilon_y)}{\mathsf{Va}(\varepsilon_m)},
\end{align*}\]</span> which introduces bias in the <span class="math inline">\(\mathsf{ACME}(x)\)</span>. Even if the true covariance is unknown, we can vary <span class="math inline">\(\rho=\mathsf{Cor}(\varepsilon_m, \varepsilon_y)\)</span> to assess the sensitivity of our conclusions to confounding. The <code>medsens</code> function in the <strong>R</strong> package <code>mediation</code> implements the diagnostic of <span class="citation" data-cites="Imai:2010">Imai, Keele, and Tingley (<a href="references.html#ref-Imai:2010" role="doc-biblioref">2010</a>)</span> for the linear mediation model.</p>
<div id="def-moderated-mediation" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 13.4 (Moderated mediation)</strong></span> We consider a more complex setting where the effect of the experimental factor <span class="math inline">\(X\)</span> depends on the mediator, a case termed <strong>moderated mediator</strong> <span class="citation" data-cites="Judd.Kenny:1981">(<a href="references.html#ref-Judd.Kenny:1981" role="doc-biblioref">Judd and Kenny 1981</a>)</span>.</p>
<p>In this case, the equation for the response variable becomes <span class="math display">\[\begin{align*}
\mathsf{E}(Y \mid M=m, X=x, \boldsymbol{Z} = \boldsymbol{z}) = c_Y + \beta x + \gamma m + \kappa x m + \boldsymbol{z}\boldsymbol{\omega}
\end{align*}\]</span> Upon substituting the equations for both inside the definition of average causal mediation effect, we find that the latter equals <span class="math display">\[\begin{align*}
\mathsf{ACME}(x) = (\gamma + \kappa x)\{M(1)-M(0)\} = \alpha (\gamma + \kappa x).
\end{align*}\]</span> and thus the value differs depending on experimental regime (treatment or control), due to the presence of the interaction. Both the average direct and total effects now depend on the theoretical average values of the covariates <span class="math inline">\(\boldsymbol{Z}\)</span> added to the model to control for confounding.</p>
</div>
<div id="exm-mediation1" class="theorem example">
<p><span class="theorem-title"><strong>Example 13.3 (Pain as a social glue)</strong></span> We consider an example from Experiment 1 of <span class="citation" data-cites="Bastian:2014">Bastian, Jetten, and Ferris (<a href="references.html#ref-Bastian:2014" role="doc-biblioref">2014</a>)</span>, who experienced the effect of the effect of shared pain (through a manipulation) on bonding.</p>
<blockquote class="blockquote">
<p>This effect of pain remained when controlling for age (<span class="math inline">\(p = .048\)</span>), gender (<span class="math inline">\(p = .052\)</span>), and group size (<span class="math inline">\(p = .050\)</span>). None of these variables were significantly correlated with experimental condition (<span class="math inline">\(ps &gt; .136\)</span>) or perceived bonding (<span class="math inline">\(ps &gt; .925\)</span>). To determine whether the marginal tendency for the pain tasks to be viewed as more threatening than the control tasks mediated the effect of pain on perceived bonding, we conducted a bootstrap analysis (Preacher &amp; Hayes, 2008) using 5,000 resamples. The results of this analysis revealed that threat was not a significant mediator, indirect effect = <span class="math inline">\(-0.11\)</span>, SE = <span class="math inline">\(0.09\)</span>, 95% CI = [<span class="math inline">\(-0.34, 0.03\)</span>].</p>
</blockquote>
<p>The response variable <span class="math inline">\(Y\)</span> is <code>bonding</code>, the experimental factor <code>condition</code> and <code>threat</code>, the average ALES subscale about the perception of the physical task, is the postulated mediator.</p>
<p>We use the <code>mediation</code> package <span class="citation" data-cites="mediationR">(<a href="references.html#ref-mediationR" role="doc-biblioref">Tingley et al. 2014</a>)</span> for the model; the package certainly isn’t needed (nor the PROCESS macros) to run the bootstrap, which we could obtain with a single for-loop. However, it has utilities, notably for checking model assumptions, that are convenient.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mediation, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(BJF14_S1, <span class="at">package =</span> <span class="st">"hecedsm"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Mediation and response models</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>MsX <span class="ot">&lt;-</span> <span class="fu">lm</span>(threat <span class="sc">~</span> condition <span class="sc">+</span> gender <span class="sc">+</span> groupsize <span class="sc">+</span> age, </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> BJF14_S1)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>YsXM <span class="ot">&lt;-</span> <span class="fu">lm</span>(bonding <span class="sc">~</span> condition <span class="sc">+</span> threat <span class="sc">+</span> gender <span class="sc">+</span> groupsize <span class="sc">+</span> age,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> BJF14_S1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tbl-responsecoefs" class="quarto-layout-panel anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-responsecoefs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;13.2: Coefficients and standard errors of the linear regression model for <span class="citation" data-cites="Bastian:2014">Bastian, Jetten, and Ferris (<a href="references.html#ref-Bastian:2014" role="doc-biblioref">2014</a>)</span>
</figcaption>
<div aria-describedby="tbl-responsecoefs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-responsecoefs" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-responsecoefs-1" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-responsecoefs-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) mediation model
</figcaption>
<div aria-describedby="tbl-responsecoefs-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-responsecoefs-1" class="do-not-create-environment caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">coef.</th>
<th style="text-align: right;">std. error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-0.16</td>
<td style="text-align: right;">0.59</td>
</tr>
<tr class="even">
<td style="text-align: left;">condition [pain]</td>
<td style="text-align: right;">0.30</td>
<td style="text-align: right;">0.12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">gender [female]</td>
<td style="text-align: right;">-0.05</td>
<td style="text-align: right;">0.13</td>
</tr>
<tr class="even">
<td style="text-align: left;">group size</td>
<td style="text-align: right;">-0.07</td>
<td style="text-align: right;">0.05</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.02</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-responsecoefs" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-responsecoefs-2" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-responsecoefs-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) outcome model
</figcaption>
<div aria-describedby="tbl-responsecoefs-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-responsecoefs-2" class="do-not-create-environment caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">coef.</th>
<th style="text-align: right;">std. error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">2.66</td>
<td style="text-align: right;">1.47</td>
</tr>
<tr class="even">
<td style="text-align: left;">condition [pain]</td>
<td style="text-align: right;">0.66</td>
<td style="text-align: right;">0.32</td>
</tr>
<tr class="odd">
<td style="text-align: left;">threat</td>
<td style="text-align: right;">-0.24</td>
<td style="text-align: right;">0.36</td>
</tr>
<tr class="even">
<td style="text-align: left;">gender [female]</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">0.33</td>
</tr>
<tr class="odd">
<td style="text-align: left;">group size</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.13</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.07</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
<p>Both of the <code>threat</code> and <code>bonding</code> measures are average of Likert scales. We include the controls in the regression for the response to account for potential confounding between threat level and shared bonding: it is unclear whether the authors used the control covariates or whether these make sense.</p>
<p>It is instructive to perform calculations by hand. We write a little function that takes as input the coefficients and variance of the parameters <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\gamma\)</span> from the linear mediation model and returns the Sobel statistic, and the <span class="math inline">\(p\)</span>-value and 95% confidence intervals based on the (large-sample) normal approximation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate Sobel's statistic for binary treatment</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>sobel <span class="ot">&lt;-</span> <span class="cf">function</span>(alpha, gamma, alpha_var, gamma_var){</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute point estimate (product of alpha and gamma)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  pe_sob <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(alpha<span class="sc">*</span>gamma)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Obtain standard error of alpha_hat*gamma_hat</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  se_sob <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sqrt</span>(gamma<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> alpha_var <span class="sc">+</span> alpha<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> gamma_var  <span class="sc">+</span> gamma_var<span class="sc">*</span>alpha_var))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Wald statistic</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  stat <span class="ot">&lt;-</span> pe_sob<span class="sc">/</span>se_sob</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">estimate =</span> pe_sob,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">se =</span> se_sob,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">stat =</span> stat, <span class="co"># Sobel test statistic</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">pvalue =</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">pnorm</span>(<span class="fu">abs</span>(stat), <span class="at">lower.tail =</span> <span class="cn">FALSE</span>), <span class="co"># two-sided p-value</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">lowerCI =</span> pe_sob <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="at">p =</span> <span class="fl">0.025</span>)<span class="sc">*</span>se_sob,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">upperCI =</span> pe_sob <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="at">p =</span> <span class="fl">0.975</span>)<span class="sc">*</span>se_sob</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function that returns the statistic for any given data</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># This way, we can pass a bootstrap sample and get the same quantity</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>stat <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">peOnly =</span> <span class="cn">TRUE</span>){</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit models</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>mod_med <span class="ot">&lt;-</span> <span class="fu">lm</span>(threat <span class="sc">~</span> condition <span class="sc">+</span> gender <span class="sc">+</span> groupsize <span class="sc">+</span> age,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> data) <span class="co"># mediator model</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>mod_resp <span class="ot">&lt;-</span> <span class="fu">lm</span>(bonding <span class="sc">~</span> condition <span class="sc">+</span> threat <span class="sc">+</span> gender <span class="sc">+</span> groupsize <span class="sc">+</span> age,</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> data) <span class="co"># response model</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Use 'coef' to extract estimated coefficients</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co"># and 'vcov' to get the estimated covariance matrix of coefficients</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>coef_alpha <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod_med)[<span class="st">'conditionPain'</span>]</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>coef_gamma <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod_resp)[<span class="st">'threat'</span>]</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>var_alpha <span class="ot">&lt;-</span> <span class="fu">vcov</span>(mod_med)[<span class="st">'conditionPain'</span>,<span class="st">'conditionPain'</span>]</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>var_gamma <span class="ot">&lt;-</span> <span class="fu">vcov</span>(mod_resp)[<span class="st">'threat'</span>,<span class="st">'threat'</span>]</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute Sobel's statistic</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">&lt;-</span> <span class="fu">sobel</span>(<span class="at">alpha =</span> coef_alpha,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha_var =</span> var_alpha,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">gamma =</span> coef_gamma,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>             <span class="at">gamma_var =</span> var_gamma)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">isTRUE</span>(peOnly)){</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(S)</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">as.vector</span>(S[,<span class="st">'estimate'</span>]))</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Values for the paper - using large-sample approximation</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>vals <span class="ot">&lt;-</span> <span class="fu">stat</span>(<span class="at">data =</span> BJF14_S1, <span class="at">peOnly =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we turn to the nonparametric bootstrap to get a comparison of how the results would differ. We fix the seed and provide data sampled with replacement, using a simple for-loop. The number of bootstrap samples should be large enough to avoid additional variability due to resampling.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Nonparametric bootstrap analysis</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">80667</span>) <span class="co"># set random seed for reproducibility</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="dv">1000</span>L <span class="co">#number of bootstrap replications</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(BJF14_S1) <span class="co"># number of observations</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">numeric</span>(B) <span class="co"># create container</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(b <span class="cf">in</span> <span class="fu">seq_len</span>(B)){</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sample row indices with replacement at random uniformly</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  bootdata <span class="ot">&lt;-</span> BJF14_S1[<span class="fu">sample.int</span>(n, n, <span class="at">replace =</span> <span class="cn">TRUE</span>),]</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute the test statistic on the bootstrap sample</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  results[b] <span class="ot">&lt;-</span> <span class="fu">stat</span>(<span class="at">data =</span> bootdata, <span class="at">peOnly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Percentile confidence intervals</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>boot_perc_confint <span class="ot">&lt;-</span> <span class="fu">quantile</span>(results, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># If we have B a multiple of 40, then we can use the sorted observations</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># sort(results)[B*c(0.025,0.975)]</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Bootstrap p-value for test alpha*gamma=0</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>M_over_B <span class="ot">&lt;-</span> <span class="fu">mean</span>(results <span class="sc">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>boot_pval <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">min</span>(<span class="fu">c</span>(M_over_B, <span class="dv">1</span><span class="sc">-</span>M_over_B))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div id="tbl-sobol-pain" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sobol-pain-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;13.3: Average causal mediation effect for <span class="citation" data-cites="Bastian:2014">Bastian, Jetten, and Ferris (<a href="references.html#ref-Bastian:2014" role="doc-biblioref">2014</a>)</span>, with <span class="math inline">\(p\)</span>-values and 95% confidence intervals based on the normal approximation (top) and nonparametric bootstrap with percentile confidence intervals (bottom).
</figcaption>
<div aria-describedby="tbl-sobol-pain-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std. error</th>
<th style="text-align: right;">p-value</th>
<th style="text-align: right;">lower CL</th>
<th style="text-align: right;">upper CL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">-0.071</td>
<td style="text-align: right;">0.119</td>
<td style="text-align: right;">0.549</td>
<td style="text-align: right;">-0.305</td>
<td style="text-align: right;">0.162</td>
</tr>
<tr class="even">
<td style="text-align: right;">-0.071</td>
<td style="text-align: right;">0.126</td>
<td style="text-align: right;">0.534</td>
<td style="text-align: right;">-0.342</td>
<td style="text-align: right;">0.132</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>The differences between the large-sample approximation and the bootstrap, reported in <a href="#tbl-sobol-pain" class="quarto-xref">Table&nbsp;<span>13.3</span></a>, are negligible.</p>
<p>We can also use software to perform the calculations without coding manually effects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">80667</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>linmed <span class="ot">&lt;-</span> <span class="fu">mediate</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.m =</span> MsX,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.y =</span> YsXM,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sims =</span> <span class="dv">1000</span>L, <span class="co"># number of bootstrap simulations</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">boot =</span> <span class="cn">TRUE</span>, <span class="co"># use bootstrap</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">boot.ci.type =</span> <span class="st">"perc"</span>, <span class="co"># type of bootstrap: percentile</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">mediator =</span> <span class="st">"threat"</span>, <span class="co"># name of mediator</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">treat =</span> <span class="st">"condition"</span>, <span class="co"># name of treatment</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">control.value =</span> <span class="st">"Control"</span>, <span class="co"># name of control (level of 'condition')</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">treat.value =</span> <span class="st">"Pain"</span>) <span class="co"># name of treatment (level of 'condition')</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(linmed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div id="tbl-mediation1" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-mediation1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;13.4: Linear causal mediation analysis: parameter estimates, nonparametric bootstrap 95% confidence intervals and p-values with the percentile method based on 5000 bootstrap samples.
</figcaption>
<div aria-describedby="tbl-mediation1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lower 95% CI</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">upper 95% CI</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ACME</td>
<td style="text-align: right;">-0.071</td>
<td style="text-align: right;">-0.363</td>
<td style="text-align: right;">0.146</td>
<td style="text-align: right;">0.548</td>
</tr>
<tr class="even">
<td style="text-align: left;">ADE</td>
<td style="text-align: right;">0.660</td>
<td style="text-align: right;">-0.012</td>
<td style="text-align: right;">1.257</td>
<td style="text-align: right;">0.056</td>
</tr>
<tr class="odd">
<td style="text-align: left;">total effect</td>
<td style="text-align: right;">0.588</td>
<td style="text-align: right;">0.012</td>
<td style="text-align: right;">1.145</td>
<td style="text-align: right;">0.048</td>
</tr>
<tr class="even">
<td style="text-align: left;">prop. mediated</td>
<td style="text-align: right;">-0.121</td>
<td style="text-align: right;">-1.501</td>
<td style="text-align: right;">0.615</td>
<td style="text-align: right;">0.564</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<p>The first line of <a href="#tbl-mediation" class="quarto-xref">Table&nbsp;<span>13.6</span></a> gives the average conditional mediated effect (labelled ACME), the second the average direct effect (ADE) and the third the total effect (ADE + ACME). The point estimate for ACME, <span class="math inline">\(\alpha\gamma\)</span> is <span class="math inline">\(\widehat{\alpha}\widehat{\gamma} = -0.07\)</span>. The bootstrap sampling distribution is skewed to the left, a fact reflected by the asymmetric percentile confidence interval.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-densityACME" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-densityACME-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="causal-inference_files/figure-html/fig-densityACME-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-densityACME-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.10: Density of the 1000 nonparametric bootstrap estimates of the average conditional mediation effect <span class="math inline">\(\alpha\gamma\)</span>, with point estimate and 95% percentile bootstrap confidence intervals (vertical dashed lines).
</figcaption>
</figure>
</div>
</div>
</div>
<p>The sequential ignorability assumption cannot be verified, but we can see what impacts violations would have on the coefficients: the expected value of the coefficient <span class="math inline">\(\widehat{\gamma}\)</span> is <span class="math inline">\(\gamma + \mathsf{Cov}(\varepsilon_M, \varepsilon_Y)/\mathsf{Va}(\varepsilon_M)\)</span>; the second component is a bias term that does not vanish, even when the sample size grows <span class="citation" data-cites="Bullock.Green.Ha:2010">(<a href="references.html#ref-Bullock.Green.Ha:2010" role="doc-biblioref">Bullock, Green, and Ha 2010</a>)</span>. The variance of the error of the mediation and response models can be estimated, and we can vary the correlation coefficient, <span class="math inline">\(\rho=\mathsf{Cor}(\varepsilon_M, \varepsilon_Y)\)</span>, to assess the sensitivity of our conclusions if there was confounding.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>linmed_sensitivity <span class="ot">&lt;-</span> <span class="fu">medsens</span>(linmed)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(linmed_sensitivity)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Mediation Sensitivity Analysis for Average Causal Mediation Effect

Sensitivity Region

      Rho    ACME 95% CI Lower 95% CI Upper R^2_M*R^2_Y* R^2_M~R^2_Y~
[1,] -0.4  0.2533      -0.0236       0.5302         0.16       0.1144
[2,] -0.3  0.1626      -0.0723       0.3975         0.09       0.0644
[3,] -0.2  0.0805      -0.1288       0.2898         0.04       0.0286
[4,] -0.1  0.0034      -0.1969       0.2037         0.01       0.0072
[5,]  0.0 -0.0714      -0.2788       0.1360         0.00       0.0000
[6,]  0.1 -0.1462      -0.3748       0.0825         0.01       0.0072
[7,]  0.2 -0.2233      -0.4850       0.0385         0.04       0.0286

Rho at which ACME = 0: -0.1
R^2_M*R^2_Y* at which ACME = 0: 0.01
R^2_M~R^2_Y~ at which ACME = 0: 0.0072 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(linmed_sensitivity)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="causal-inference_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The <code>medsens</code> function implements the sensitivity diagnostic presented in Section 5.1 of <span class="citation" data-cites="Imai.Keele.Yamamoto:2010">Imai, Keele, and Yamamoto (<a href="references.html#ref-Imai.Keele.Yamamoto:2010" role="doc-biblioref">2010</a>)</span> for the linear mediation model. By default, the correlation <span class="math inline">\(\rho\)</span> varies in 0.1 increments. We can see the wide range of the ACME if there was correlation between residuals from the mediation and the response model, highlighting the wide range of values that could be returned: the ACME could go from <span class="math inline">\(0.2\)</span> to <span class="math inline">\(-0.288\)</span> for correlations in the range <span class="math inline">\(\rho \in [-0.4, 0.4]\)</span>. In this example, nearly any correlation in this range would lead to “insignificant results”, mostly because of the small sample size. In a situation where we had found a significant (sic) result, we could observe how much correlation btween would be needed for this effect to be an artifact of correlation and vanish.</p>
<p>According to the documentation of the <code>medsens</code> function (<code>?medsens</code>), there are two variants of the estimated effect size, either computing the proportion of the total (tilde, <code>R^2_M~R^2_Y</code>) or residual (starred, <code>R^2_M*R^2_Y*</code>) variance from the mediation and outcome models that are due to hypothetical unobserved confounders.</p>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Pitfall
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are several problems with the description of <span class="citation" data-cites="Bastian:2014">Bastian, Jetten, and Ferris (<a href="references.html#ref-Bastian:2014" role="doc-biblioref">2014</a>)</span>: while it seems that some covariates (age, gender, group size) were added to regression models, it is unclear whether they could be confounders, whether their effect is linear and in which (if any) model they are included. Stating “bootstrap analysis” is the equivalent of “running a statistical test”, so vague it could mean anything, and the fact the output is random does not help with reproducibility.</p>
</div>
</div>
<div id="exm-inconsistency" class="theorem example">
<p><span class="theorem-title"><strong>Example 13.4 (Fluency as mediator of product evaluation)</strong></span> Study 2 of <span class="citation" data-cites="Lee.Choi:2019">Lee and Choi (<a href="references.html#ref-Lee.Choi:2019" role="doc-biblioref">2019</a>)</span> focus on inconsistency of photos and text descriptions for online descriptions and how this impact the product evaluation.</p>
<p>The experimental variable is the consistency of the product description and depiction, with <code>fluency</code> leading to “processing disfluency” that is expected to impact negatively judgment ratings. Familiarity with the product brand and product is included as covariate in both mediator and outcome model (see Table 1 of <span class="citation" data-cites="Lee.Choi:2019">Lee and Choi (<a href="references.html#ref-Lee.Choi:2019" role="doc-biblioref">2019</a>)</span>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(LC19_S2, <span class="at">package =</span> <span class="st">"hecedsm"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>LC19_S2 <span class="ot">&lt;-</span> LC19_S2 <span class="sc">|&gt;</span> <span class="co"># transform consistency into </span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">consistency =</span> <span class="fu">ifelse</span>(consistency <span class="sc">==</span> <span class="st">"inconsistent"</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>YsMX <span class="ot">&lt;-</span> <span class="fu">lm</span>(prodeval <span class="sc">~</span> fluency <span class="sc">+</span> consistency <span class="sc">+</span> familiarity,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> LC19_S2)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>MsX <span class="ot">&lt;-</span> <span class="fu">lm</span>(fluency <span class="sc">~</span> consistency <span class="sc">+</span> familiarity,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> LC19_S2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tbl-coefsmediation" class="quarto-layout-panel anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-coefsmediation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;13.5: Model coefficients
</figcaption>
<div aria-describedby="tbl-coefsmediation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-coefsmediation" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-coefsmediation-1" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-coefsmediation-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) mediation
</figcaption>
<div aria-describedby="tbl-coefsmediation-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-coefsmediation-1" class="do-not-create-environment caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">5.23</td>
<td style="text-align: right;">0.27</td>
</tr>
<tr class="even">
<td style="text-align: left;">consistency</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">0.24</td>
</tr>
<tr class="odd">
<td style="text-align: left;">familiarity</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.06</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-coefsmediation" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-coefsmediation-2" class="do-not-create-environment quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-coefsmediation-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) outcome
</figcaption>
<div aria-describedby="tbl-coefsmediation-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-coefsmediation-2" class="do-not-create-environment caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">3.04</td>
<td style="text-align: right;">0.53</td>
</tr>
<tr class="even">
<td style="text-align: left;">fluency</td>
<td style="text-align: right;">0.60</td>
<td style="text-align: right;">0.09</td>
</tr>
<tr class="odd">
<td style="text-align: left;">consistency</td>
<td style="text-align: right;">0.29</td>
<td style="text-align: right;">0.22</td>
</tr>
<tr class="even">
<td style="text-align: left;">familiarity</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.05</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
<p>We can extract the effects directly from the outcome: the natural indirect effect estimate is <span class="math inline">\(\widehat{\alpha}\widehat{\gamma} = 0.48 \times 0.60\)</span> and the direct effect is <span class="math inline">\(\widehat{\beta} = 0.29\)</span>.</p>
<p>To get confidence intervals, we can use the <code>mediate</code> package <span class="citation" data-cites="mediationR">(<a href="references.html#ref-mediationR" role="doc-biblioref">Tingley et al. 2014</a>)</span>. The function requires the parametric model for the mediation and outcome, as well as a series of specification (the number of bootstrap samples, the type of confidence interval, the names of the levels for categorical treatment, etc.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">80667</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mediation, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>linmed <span class="ot">&lt;-</span> <span class="fu">mediate</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.m =</span> MsX,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.y =</span> YsMX,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">treat =</span> <span class="st">"consistency"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">mediator =</span> <span class="st">"fluency"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">sims =</span> <span class="dv">5000</span>L,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">boot =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">boot.ci.type =</span> <span class="st">"perc"</span>, <span class="co"># percentile method</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="do">## with original factor, we could specify the levels for control and treatment</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">#  control.value = "inconsistent", </span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">#  treat.value = "consistent"</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-effect-LC19" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-effect-LC19-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="causal-inference_files/figure-html/fig-effect-LC19-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-effect-LC19-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.11: Causal effects and confidence intervals for the difference between inconsistency (control) and consistency (treatement).
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div id="tbl-mediation" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-mediation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;13.6: Linear causal mediation analysis: parameter estimates, nonparametric bootstrap 95% percentile confidence intervals and p-values based on 5000 nonparametric bootstrap samples.
</figcaption>
<div aria-describedby="tbl-mediation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lower 95% CI</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">upper 95% CI</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ACME</td>
<td style="text-align: right;">0.286</td>
<td style="text-align: right;">0.015</td>
<td style="text-align: right;">0.595</td>
<td style="text-align: right;">0.037</td>
</tr>
<tr class="even">
<td style="text-align: left;">ADE</td>
<td style="text-align: right;">0.287</td>
<td style="text-align: right;">-0.165</td>
<td style="text-align: right;">0.737</td>
<td style="text-align: right;">0.218</td>
</tr>
<tr class="odd">
<td style="text-align: left;">total effect</td>
<td style="text-align: right;">0.573</td>
<td style="text-align: right;">0.047</td>
<td style="text-align: right;">1.091</td>
<td style="text-align: right;">0.030</td>
</tr>
<tr class="even">
<td style="text-align: left;">prop. mediated</td>
<td style="text-align: right;">0.499</td>
<td style="text-align: right;">-0.051</td>
<td style="text-align: right;">1.938</td>
<td style="text-align: right;">0.057</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
<p>Using the <code>summary</code> method, we can print the table of estimates and confidence intervals. We can see that the results are consistent with those reported in the article. We can also use the <code>medsens</code> function to perform the sensitivity analysis, but this only works for binary (numerical) treatments.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mediation<span class="sc">::</span><span class="fu">medsens</span>(<span class="at">x =</span> linmed))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-sensitivity" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sensitivity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="causal-inference_files/figure-html/fig-sensitivity-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sensitivity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13.12: Sensitivity analysis showing the variation of the average causal mediation effect as a function of the correlation between outcome and mediation errors, with pointwise 95% confidence intervals.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="general-average-causal-mediation-effect-estimation" class="level2" data-number="13.5">
<h2 data-number="13.5" class="anchored" data-anchor-id="general-average-causal-mediation-effect-estimation"><span class="header-section-number">13.5</span> General average causal mediation effect estimation</h2>
<p>The linear mediation model is popular, but is limited to the case with no interaction, continuous mediators, constant (i.e., linear) treatment effect, and continuous response. It also hides model assumptions.</p>
<p>We could also rely on different models and use the definitions of the causal effects to perform simulation-based inference; see Appendix D of <span class="citation" data-cites="Imai:2010">Imai, Keele, and Tingley (<a href="references.html#ref-Imai:2010" role="doc-biblioref">2010</a>)</span>. The average causal mediation effect can be estimated empirically based on the simulated potential outcomes. Using <a href="#def-ate" class="quarto-xref">Definition&nbsp;<span>13.1</span></a>, the method of <span class="citation" data-cites="Imai:2010">Imai, Keele, and Tingley (<a href="references.html#ref-Imai:2010" role="doc-biblioref">2010</a>)</span> relies on Monte Carlo simulations.</p>
<ol type="1">
<li><strong>Modelling</strong>. Specify models to each relationship
<ol type="a">
<li>a mediator model <span class="math inline">\(f_M(x, \boldsymbol{z}; \boldsymbol{\theta}_M)\)</span> that includes <span class="math inline">\(X\)</span> and potential confounders <span class="math inline">\(\boldsymbol{Z}\)</span></li>
<li>an outcome model <span class="math inline">\(f_Y(x, m, \boldsymbol{z}; \boldsymbol{\theta}_Y)\)</span> with both treatment indicator <span class="math inline">\(X\)</span>, mediator <span class="math inline">\(M\)</span><a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> and potential confounders <span class="math inline">\(\boldsymbol{Z}\)</span>.</li>
</ol></li>
<li>Draw <span class="math inline">\(B\)</span> realizations of the mediation model for each observation <span class="math inline">\(i=1, \ldots, n\)</span>, giving <span class="math inline">\(M^{(b)}_i(1)\)</span> and <span class="math inline">\(M^{(b)}_i(0)\)</span> for <span class="math inline">\(b=1, \ldots, B\)</span>. Use these resulting to obtain one draw from the outcome model for each of
<ol type="a">
<li><span class="math inline">\(Y_{i}^{(b)}\{0, M^{(b)}_i(0)\}\)</span>,</li>
<li><span class="math inline">\(Y_{i}^{(b)}\{0, M^{(b)}_i(1)\}\)</span>,</li>
<li><span class="math inline">\(Y_{i}^{(b)}\{1, M^{(b)}_i(0)\}\)</span> and</li>
<li><span class="math inline">\(Y_{i}^{(b)}\{1, M^{(b)}_i(1)\}\)</span>.</li>
</ol></li>
<li>Plug these quantities in the definitions of <span class="math inline">\(\mathsf{ACME}(x)\)</span>, <span class="math inline">\(\mathsf{ADE}(x)\)</span> and <span class="math inline">\(\mathsf{TE}\)</span>, averaging over the <span class="math inline">\(nM\)</span> replications, over both observations <span class="math inline">\(i=1, \ldots, n\)</span> and replications <span class="math inline">\(b=1, \ldots, B\)</span>, e.g., <span class="math display">\[\begin{align*}
\mathsf{TE} = \frac{1}{nB} \sum_{b=1}^B \sum_{i=1}^n \left[ Y_{i}^{(b)}\{1, M^{(b)}_i(1)\} - Y_{i}^{(b)}\{0, M^{(b)}_i(0)\}\right]
\end{align*}\]</span></li>
<li><strong>Estimation uncertainty</strong>: Either use nonparametric bootstrap or a large-sample approximation to the distribution of model parameters <span class="math inline">\(\boldsymbol{\theta}_M\)</span> and <span class="math inline">\(\boldsymbol{Y}\)</span> to get <span class="math inline">\(J\)</span> copies of parameters, and repeat steps 2. and 3. to get <span class="math inline">\(J\)</span> copies of the causal estimates. Use the <span class="math inline">\(J\)</span> replications to compute a 95% percentile interval and return the sample means over <span class="math inline">\(J\)</span> for the average causal effects.</li>
</ol>
<p>The benefit of this method is that it naturally account for nonlinear effects, different natures of the mediator (binary, categorical, etc.) and the response, through suitable models, e.g., a logistic regression for a binary outcome. With repeated measures, one could also consider interactions between individuals and mediator using random effects, and still retrieve an effect. The framework easily handles interactions between <span class="math inline">\(X:M\)</span> added to the outcome model, in which case we get different values of average causal mediation effect and average direct effect for each value of <span class="math inline">\(X\)</span>.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Baron.Kenny:1986" class="csl-entry" role="listitem">
Baron, R. M., and D. A. Kenny. 1986. <span>“The Moderator-Mediator Variable Distinction in Social Psychological Research: Conceptual, Strategic, and Statistical Considerations.”</span> <em>Journal of Personality and Social Psychology</em> 51 (6): 1173–82. <a href="https://doi.org/10.1037/0022-3514.51.6.1173">https://doi.org/10.1037/0022-3514.51.6.1173</a>.
</div>
<div id="ref-Bastian:2014" class="csl-entry" role="listitem">
Bastian, Brock, Jolanda Jetten, and Laura J. Ferris. 2014. <span>“Pain as Social Glue: Shared Pain Increases Cooperation.”</span> <em>Psychological Science</em> 25 (11): 2079–85. <a href="https://doi.org/10.1177/0956797614545886">https://doi.org/10.1177/0956797614545886</a>.
</div>
<div id="ref-Bullock.Green.Ha:2010" class="csl-entry" role="listitem">
Bullock, J. G., Green D. P., and S. E. Ha. 2010. <span>“Yes, but What’s the Mechanism? (Don’t Expect an Easy Answer).”</span> 98 (4): 550–58. <a href="https://doi.org/10.1037/a0018933">https://doi.org/10.1037/a0018933</a>.
</div>
<div id="ref-Davison.Hinkley:1997" class="csl-entry" role="listitem">
Davison, A. C., and D. V. Hinkley. 1997. <em>Bootstrap Methods and Their Application</em>. New York, NY: Cambridge University Press.
</div>
<div id="ref-Efron:1979" class="csl-entry" role="listitem">
Efron, B. 1979. <span>“Bootstrap Methods: Another Look at the Jackknife.”</span> <em>The Annals of Statistics</em> 7 (1): 1–26. <a href="https://doi.org/10.1214/aos/1176344552">https://doi.org/10.1214/aos/1176344552</a>.
</div>
<div id="ref-Efron.Tibshirani:1993" class="csl-entry" role="listitem">
Efron, B., and R. J. Tibshirani. 1993. <em>An Introduction to the Bootstrap</em>. Boca Raton, FL: CRC Press.
</div>
<div id="ref-Imai:2010" class="csl-entry" role="listitem">
Imai, Kosuke, Luke Keele, and Dustin Tingley. 2010. <span>“A General Approach to Causal Mediation Analysis.”</span> <em>Psychological Methods</em> 15 (4): 309–34. <a href="https://doi.org/10.1037/a0020761">https://doi.org/10.1037/a0020761</a>.
</div>
<div id="ref-Imai.Keele.Yamamoto:2010" class="csl-entry" role="listitem">
Imai, Kosuke, Luke Keele, and Teppei Yamamoto. 2010. <span>“Identification, Inference and Sensitivity Analysis for Causal Mediation Effects.”</span> <em>Statistical Science</em> 25 (1): 51–71. <a href="https://doi.org/10.1214/10-STS321">https://doi.org/10.1214/10-STS321</a>.
</div>
<div id="ref-Imbens.Rubin:2015" class="csl-entry" role="listitem">
Imbens, Guido W., and Donald B. Rubin. 2015. <em>Causal Inference for Statistics, Social, and Biomedical Sciences: An Introduction</em>. Cambridge, UK: Cambridge University Press. <a href="https://doi.org/10.1017/CBO9781139025751">https://doi.org/10.1017/CBO9781139025751</a>.
</div>
<div id="ref-Judd.Kenny:1981" class="csl-entry" role="listitem">
Judd, Charles M., and David A. Kenny. 1981. <span>“Process Analysis: Estimating Mediation in Treatment Evaluations.”</span> <em>Evaluation Review</em> 5 (5): 602–19. <a href="https://doi.org/10.1177/0193841X8100500502">https://doi.org/10.1177/0193841X8100500502</a>.
</div>
<div id="ref-Kowal:2021" class="csl-entry" role="listitem">
Kowal, Agata AND Kochan-Wójcik, Marta AND Groyecka-Bernard. 2021. <span>“When and How Does the Number of Children Affect Marital Satisfaction? An International Survey.”</span> <em>PLOS ONE</em> 16 (4): 1–14. <a href="https://doi.org/10.1371/journal.pone.0249516">https://doi.org/10.1371/journal.pone.0249516</a>.
</div>
<div id="ref-Lee.Choi:2019" class="csl-entry" role="listitem">
Lee, Kiljae, and Jungsil Choi. 2019. <span>“Image-Text Inconsistency Effect on Product Evaluation in Online Retailing.”</span> <em>Journal of Retailing and Consumer Services</em> 49: 279–88. <a href="https://doi.org/10.1016/j.jretconser.2019.03.015">https://doi.org/10.1016/j.jretconser.2019.03.015</a>.
</div>
<div id="ref-McKinnon:2002" class="csl-entry" role="listitem">
MacKinnon, David P., Chondra M. Lockwood, Jeanne M. Hoffman, Stephen G. West, and Virgil Sheets. 2002. <span>“A Comparison of Methods to Test Mediation and Other Intervening Variable Effects.”</span> <em>Psychological Methods</em> 7 (1): 83–104. <a href="https://doi.org/10.1037/1082-989X.7.1.83">https://doi.org/10.1037/1082-989X.7.1.83</a>.
</div>
<div id="ref-McQuire:2020" class="csl-entry" role="listitem">
McQuire, Cheryl, R. Daniel, L. Hurt, A. Kemp, and S. Paranjothy. 2020. <span>“The Causal Web of Foetal Alcohol Spectrum Disorders: A Review and Causal Diagram.”</span> <em>European Child <span>&amp;</span> Adolescent Psychiatry</em> 29 (5): 575–94. <a href="https://doi.org/10.1007/s00787-018-1264-3">https://doi.org/10.1007/s00787-018-1264-3</a>.
</div>
<div id="ref-Pearl:2014" class="csl-entry" role="listitem">
Pearl, Judea. 2014. <span>“Interpretation and Identification of Causal Mediation.”</span> <em>Psychological Methods</em> 19 (4): 459–81. <a href="https://doi.org/10.1037/a0036434">https://doi.org/10.1037/a0036434</a>.
</div>
<div id="ref-Pearl:2016" class="csl-entry" role="listitem">
Pearl, Judea, Maria Glymour, and Nicholas Jewell. 2016. <em>Causal Inference in Statistics: A Primer</em>. Chichester, UK: Wiley.
</div>
<div id="ref-Preacher.Hayes:2004" class="csl-entry" role="listitem">
Preacher, Kristopher J., and Andrew F. Hayes. 2004. <span>“<span>SPSS</span> and <span>SAS</span> Procedures for Estimating Indirect Effects in Simple Mediation Models.”</span> <em>Behavior Research Methods, Instruments <span>&amp;</span> Computers</em> 36: 717–31. <a href="https://doi.org/10.3758/BF03206553">https://doi.org/10.3758/BF03206553</a>.
</div>
<div id="ref-Robins.Greenland:1992" class="csl-entry" role="listitem">
Robins, James M., and Sander Greenland. 1992. <span>“Identifiability and Exchangeability for Direct and Indirect Effects.”</span> <em>Epidemiology</em> 3 (2). <a href="https://journals.lww.com/epidem/fulltext/1992/03000/identifiability_and_exchangeability_for_direct_and.13.aspx">https://journals.lww.com/epidem/fulltext/1992/03000/identifiability_and_exchangeability_for_direct_and.13.aspx</a>.
</div>
<div id="ref-mediationR" class="csl-entry" role="listitem">
Tingley, Dustin, Teppei Yamamoto, Kentaro Hirose, Luke Keele, and Kosuke Imai. 2014. <span>“<code>mediation</code>: <span>R</span> Package for Causal Mediation Analysis.”</span> <em>Journal of Statistical Software</em> 59 (5): 1–38. <a href="https://doi.org/10.18637/jss.v059.i05">https://doi.org/10.18637/jss.v059.i05</a>.
</div>
<div id="ref-Vanderweele:2015" class="csl-entry" role="listitem">
VanderWeele, Tyler. 2015. <em>Explanation in Causal Inference: Methods for Mediation and Interaction</em>. New York, NY: Oxford University Press.
</div>
<div id="ref-Zhao.Lynch.Chen:2010" class="csl-entry" role="listitem">
Zhao, Xinshu, Jr. Lynch John G., and Qimei Chen. 2010. <span>“Reconsidering <span>B</span>aron and <span>K</span>enny: Myths and Truths about Mediation Analysis.”</span> <em>Journal of Consumer Research</em> 37 (2): 197–206. <a href="https://doi.org/10.1086/651257">https://doi.org/10.1086/651257</a>.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>The notation is important to distinguish between association <span class="math inline">\(Y \mid X\)</span> when observing <span class="math inline">\(X\)</span> from experimental manipulations or interventions, <span class="math inline">\(Y \mid \mathsf{do}(X)\)</span> and counterfactuals <span class="math inline">\(Y(X)\)</span>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The dependence on <span class="math inline">\(\boldsymbol{Z}\)</span> is used for situations where we can perform randomization based on pre-treatment assignment (i.e., we specify a mechanisms that is not equal based, but the probability of assignment is known for each individual).<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Sobel derived the asymptotic variance using a first-order Taylor series expansion assuming both <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\gamma\)</span> are non-zero (hence the tests!)<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>The latter is the name of the method used to derive the denominator of Sobel’s statistic.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Optionally, add their interaction <span class="math inline">\(X:M\)</span> in case of moderated mediation.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/lbelzile\.github\.io\/math80667a\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./mixed.html" class="pagination-link" aria-label="Introduction to mixed models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to mixed models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./nonparametric.html" class="pagination-link" aria-label="Nonparametric tests">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Nonparametric tests</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/lbelzile/math80667a/edit/main/causal-inference.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>